<%
count = page.children.count
children = count > 0
expanded = expanded_rows.include?(page.id)
padding_left = (level * 22) + 4

children_class = children ? (expanded ? ' children-visible' : ' children-hidden') : ' no-children'
virtual_class = page.virtual? ? " virtual": ""

expander = children ? image((expanded ? "collapse" : "expand"), :class => "expander", :alt => 'toggle children', :title => '', :align => 'center') : ""

icon_name = page.virtual? ? "virtual-page" : "page"
icon = image(icon_name, :class => "icon", :alt => 'page-icon', :title => '', :align => 'center')

title = %{<span class="title">#{ page.title }</span>}

display_name = page.class.display_name
page_type = display_name == 'Page' ? '' : %{<small class="info">(#{ display_name })</small>}

spinner = image('spinner.gif', :class => 'busy', :id => "busy-#{page.id}", :alt => "", :title => "", :align => "center", :style => 'display: none;')
-%>

<% 
if @current_page.nil? or page.nil?
  row_class = nil
else
  row_class = @current_page.id == page.id ? 'current' : ''
end
%>

    <tr id="page-<%= page.id %>" class="node level-<%= level %><%= children_class %><%= virtual_class %> <%= row_class %>">
      <td class="page" style="padding-left: <%= padding_left %>px">
        <span class="w1">
<% if simple -%>
  <%= link_to_remote "#{icon} #{title}", :url => {:controller => 'admin/nice_assets', :action => 'link_page', :id => @current_page, :page => page.id}, :before => %{Element.show('page-browse-loading')} %>
<% else -%>
	<%= expander %>
  <%= link_to_remote "#{icon} #{title}", :url => {:controller => 'admin/nice_assets', :action => 'link_page', :id => @current_page, :page => page.id}, :before => %{Element.show('page-browse-loading')} %>
	<%= page_type %>
	<%= spinner %>
<% end -%>
        </span>
      </td>
			<td>
					<a href="<%= page_edit_url(:id => page) %>" target="_blank" title="View page: <%= page.url %>">
						<img src="/images/extensions/nice_assets/magnifier.png" width="16" height="16" alt="view" />
					</a>
			</td>
<% unless simple -%>
      <td class="status <%= page.status.name.downcase %>-status"><%= page.status.name %></td>
<% end -%>
    </tr>
<% level = level + 1 -%>
<%
if expanded
  page.children.each do |child|
-%>
<%= render_node_basic child, :level => level, :simple => simple -%>
<%
  end
end
-%>
