<script language="javascript" type="text/javascript" src="/javascripts/admin/jquery.tablesorter.min.js"></script>
<script language="javascript" type="text/javascript" src="/javascripts/extensions/nice_assets/jquery.colorbox-min.js"></script>
<link rel="stylesheet" href="/stylesheets/admin/nice_assets.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="/stylesheets/extensions/nice_assets/colorbox/colorbox.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {
    $('#asset_list tbody td[class!=actions]').click(function() {
      src = parent.document.getElementById('src');
      if (src) {
        url = $(this).parent().find("input[name=url]").val().replace(/\?\d+$/, '');
      } else {
        src = parent.document.getElementById('href');
        url = $(this).parent().find("input[name=url_full]").val().replace(/\?\d+$/, '');
      }
      src.value = url;
      title = parent.document.getElementById('title');
      title.value = $(this).parent().find("td.title").text();
      mcTabs.displayTab('general_tab','general_panel');
    });
    
    assign_actions();
  });
  
  function assign_actions() {
    $("td.actions .show").colorbox();
    $("td.actions .delete").click(function() {
      if (confirm("Are you sure you want to delete this file?\n\nDeleting this file may leave broken links if references to this file exist on the site.")) {
        var id = $(this).attr('rel');
        var row = $(this).closest('tr').attr('id');
        $.post("/page_attachments/delete/" + id, {row: row},
          function(data, message){
            $("#" + row).fadeOut('slow');
        });
      }
    });
  }

  $("#asset_list").tablesorter({
    sortList: [[2,1]],
    headers: {
      0: {sorter: false},
      4: {sorter: false}
    }
  });
</script>


<div id="popup">
  <div id="asset_list_wrapper">
    <table id="asset_list">
        <thead>
          <tr>
            <th scope="col">Asset</th>
            <th scope="col">Filename</th>
            <th scope="col">Date</th>
            <th scope="col">Title</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody>
          <%- @files.each do |asset| -%>
            <%= render :partial => 'admin/assets/popup_asset', :locals => {:asset => asset} %>
          <%- end -%>
        </tbody>
      </table>
    </div> <!-- #asset_list_wrapper -->

  </div>