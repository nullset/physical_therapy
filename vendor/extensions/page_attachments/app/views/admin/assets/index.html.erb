<%- include_stylesheet 'admin/nice_assets' -%>
<%- include_javascript 'admin/jquery-1.3.2.min' -%>
<%- include_javascript 'admin/jquery_no_conflict' -%>
<%- include_javascript 'admin/jquery.tablesorter.min.js' -%>
<%- include_javascript 'admin/swfobject' -%>
<%- include_javascript 'admin/jquery.uploadify.v2.1.0.min' -%>
<%- include_javascript 'extensions/nice_assets/jquery.simplemodal-1.3.3.min.js' -%>
<%- include_stylesheet 'admin/nice_assets' -%>


<script type="text/javascript" charset="utf-8">
jQuery(document).ready(function() {
  jQuery("#add_nice_asset").mouseup(function() {
    jQuery("#uploader").modal();
  });  
  
  var first_body_row = jQuery('#asset_list tbody tr:first td');
  var header_row = jQuery('#asset_list thead tr:first th');
  // alert(first_body_row.eq(0).width());
  
  var length = first_body_row.length;
  for (i=0; i < length; i++) {
    header_row.eq(i).css('width', first_body_row.eq(i).css('width'));
  }
  // var i = 0;
  // first_body_row.each(function() {
  //   alert($(this).css('width'));
  //   width = $(this).width();
  //   // alert(header_row.eq(i).text());
  //   // header_row.eq(i).css('width', width);
  //   i++;
  // });
  
  jQuery("#asset_list").tablesorter({
    sortList: [[2,1]],
    headers: {
      0: {sorter: false},
      5: {sorter: false},
      6: {sorter: false}
    }
  });
  
  jQuery("span.delete").mouseup(function() {
    if (confirm('Are you sure you want to delete this asset?\n\nClicking "ok" will entirely remove this file from your website, and may leave broken links on pages that reference this file.')) {
      id = jQuery(this).find('input:first').val();
      row = jQuery(this).closest('tr');
      row.css({'background' : '#ddd', 'color' : '#6f0000'});
      // jQuery(this).closest('tr').remove();
      jQuery.post("/page_attachments/delete/" + id, {},
        function(data){
          row.fadeOut('slow');
      });
    }
  });  
  
});
</script>

<div id="asset_list_wrapper">
  <table id="asset_list">
    <thead>
      <tr>
        <th scope="col">Asset</th>
        <th scope="col">Filename</th>
        <th scope="col">Date</th>
        <th scope="col">Title</th>
        <th scope="col">#</th>
        <th scope="col">Pages</th>
        <th scope="col">Actions</th>
      </tr>
    </thead>
    <tbody>
      <%- @assets.each do |asset| -%>
        <%= render :partial => 'admin/pages/nice_asset_row', :locals => {:asset => asset} %>
      <%- end -%>
    </tbody>
  </table>
</div> <!-- #asset_list_wrapper -->

<p><button id="add_nice_asset">+ Upload new asset</button></p>
<%= render :partial => 'admin/assets/uploader' %>

<%- include_javascript 'extensions/tiny_mce_filter/tiny_mce.js' -%>
<%- include_javascript 'extensions/tiny_mce_filter/tiny_mce_settings.js' -%>
<%- include_javascript 'extensions/tiny_mce_filter/tiny_mce_popup.js' -%>
<script type="text/javascript" charset="utf-8">
var FileBrowserDialogue = {
    init : function () {
        // Here goes your code for setting your custom things onLoad.
    },
    mySubmit : function () {
        var URL = jQuery(".asset img:first").attr('src').replace(/\?\d+$/, ''); // document.my_form.my_field.value;
        var win = tinyMCEPopup.getWindowArg("window");
        alert(URL);

        // insert information now
        win.document.getElementById(tinyMCEPopup.getWindowArg("input")).value = URL;

        // are we an image browser
        if (typeof(win.ImageDialog) != "undefined") {
            // we are, so update image dimensions...
            if (win.ImageDialog.getImageData)
                win.ImageDialog.getImageData();

            // ... and preview if necessary
            if (win.ImageDialog.showPreviewImage)
                win.ImageDialog.showPreviewImage(URL);
        }

        // close popup window
        tinyMCEPopup.close();
    }
}

  // tinyMCEPopup.onInit.add(FileBrowserDialogue.init, FileBrowserDialogue);
  FileBrowserDialogue.init;
  FileBrowserDialogue.mySubmit();
</script>

