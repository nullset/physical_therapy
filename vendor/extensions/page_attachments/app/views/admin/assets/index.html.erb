<%- include_stylesheet 'admin/nice_assets' -%>
<%- include_javascript 'admin/jquery-1.3.2.min' -%>
<%- include_javascript 'admin/jquery_no_conflict' -%>
<%- include_javascript 'admin/jquery.tablesorter.min.js' -%>
<%- include_javascript 'admin/swfobject' -%>
<%- include_javascript 'admin/jquery.uploadify.v2.1.0.min' -%>
<%- include_javascript 'extensions/nice_assets/jquery.simplemodal-1.3.3.min.js' -%>
<%- include_stylesheet 'admin/nice_assets' -%>


<script type="text/javascript" charset="utf-8">
jQuery(document).ready(function() {
  jQuery("#add_nice_asset").mouseup(function() {
    jQuery("#uploader").modal();
  });  
  
  // var first_body_row = jQuery('#asset_list tbody tr:first td');
  // var header_row = jQuery('#asset_list thead tr:first th');
  // // alert(first_body_row.eq(0).width());
  // 
  // var length = first_body_row.length;
  // for (i=0; i < length; i++) {
  //   header_row.eq(i).css('width', first_body_row.eq(i).css('width'));
  // }
  // var i = 0;
  // first_body_row.each(function() {
  //   alert($(this).css('width'));
  //   width = $(this).width();
  //   // alert(header_row.eq(i).text());
  //   // header_row.eq(i).css('width', width);
  //   i++;
  // });
  
  jQuery("#asset_list").tablesorter({
    sortList: [[2,1]],
    headers: {
      0: {sorter: false},
      4: {sorter: false}
    }
  });
  
  jQuery("span.delete").mouseup(function() {
    if (confirm('Are you sure you want to delete this asset?\n\nClicking "ok" will entirely remove this file from your website, and may leave broken links on pages that reference this file.')) {
      id = jQuery(this).find('input:first').val();
      row = jQuery(this).closest('tr');
      row.css({'background' : '#ddd', 'color' : '#6f0000'});
      // jQuery(this).closest('tr').remove();
      jQuery.post("/page_attachments/delete/" + id, {},
        function(data){
          row.fadeOut('slow');
      });
    }
  });  
  
});
</script>

<div id="asset_list_wrapper">
  <table id="asset_list">
    <thead>
      <tr>
        <th scope="col">Asset</th>
        <th scope="col">Filename</th>
        <th scope="col">Date</th>
        <th scope="col">Title</th>
        <th scope="col">Actions</th>
      </tr>
    </thead>
    <tbody>
      <%- @assets.each do |asset| -%>
        <%= render :partial => 'admin/assets/popup_asset', :locals => {:asset => asset} %>
      <%- end -%>
    </tbody>
  </table>
</div> <!-- #asset_list_wrapper -->

<p><button id="add_nice_asset">+ Upload new asset</button></p>
<%= render :partial => 'admin/assets/uploader' %>

