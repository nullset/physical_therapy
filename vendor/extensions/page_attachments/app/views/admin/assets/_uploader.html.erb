<div id="uploader">
  <div><%= label_tag :upload_title, 'Title' %><%= text_field_tag :upload_title %><div id="nice_assets_uploader"></div></div>
</div> <!-- #uploader -->

<script type="text/javascript" charset="utf-8">

  jQuery(document).ready(function() {
    
    <%- session_key_name = ActionController::Base.session_options[:session_key] -%>
    jQuery('#nice_assets_uploader').uploadify({
      'uploader': '/images/extensions/nice_assets/uploadify.swf',
      'script': '/page_attachments/create',
      'folder': '/path/to/uploads-folder',
      'cancelImg': '/images/extensions/nice_assets/cancel.png',
      'auto': true,
      'fileDataName': 'uploaded_data',
      'buttonImg': '/images/extensions/nice_assets/choose_file.png',
      'scriptData': {
        // '_method': 'put',
        '<%= session_key_name %>' : '<%= u cookies[session_key_name] %>',
        'authenticity_token'  : '<%= u form_authenticity_token if protect_against_forgery? %>',
        <%- if @page && @page.id -%>
          'page_id' : '<%= @page.id %>',
        <%- end -%>
        'user_id' : '<%= current_user.id %>',
        'title' : ''
      },
      'onComplete': function(event, queueID, fileObj, response, data) {
        <%- if @page && @page.id -%>
          // alert(event + " :: " + queueID + " :: " + fileObj + " :: " + response + " :: " + data);
          jQuery('#nice_assets').append(response);
          var attachments_count = jQuery('#nice_assets li').length;
          jQuery("#attachments_count").text('(' + attachments_count + ')');
             // $('#filesUploaded').append('<a href='+fileObj.filePath+'>'+response+'</a><br>');
          jQuery('#upload_title').val('');
        <%- else -%>
          jQuery("#asset_list tbody").prepend(response);
        <%- end -%>
      }
    });
    
    jQuery('#upload_title').keyup(function() {
      jQuery('#nice_assets_uploader').uploadifySettings('scriptData', {'title' : jQuery('#upload_title').val() });
    });
    
  });

</script>